<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
      .text { font-family: Arial, sans-serif; font-size: 12px; }
      .small-text { font-family: Arial, sans-serif; font-size: 11px; }
      .layer { fill: #e1d5e7; stroke: #9673a6; fill-opacity: 0.3; }
      .client-comp { fill: #dae8fc; stroke: #6c8ebf; }
      .server-comp { fill: #dae8fc; stroke: #6c8ebf; }
      .support-comp { fill: #d5e8d4; stroke: #82b366; }
      .security-comp { fill: #f8cecc; stroke: #b85450; }
      .network-comp { fill: #fff2cc; stroke: #d6b656; }
      .engine-comp { fill: #d5e8d4; stroke: #82b366; }
      .monitoring-comp { fill: #d5e8d4; stroke: #82b366; }
      .client-conn { stroke: #27ae60; stroke-width: 2; }
      .server-conn { stroke: #f39c12; stroke-width: 2; }
      .rpc-conn { stroke: #e74c3c; stroke-width: 3; }
      .engine-conn { stroke: #9b59b6; stroke-width: 2; }
      .monitor-conn { stroke: #8e44ad; stroke-width: 2; }
    </style>
  </defs>
  
  <!-- 标题 -->
  <text x="500" y="30" text-anchor="middle" class="title">Hadoop RPC整体架构</text>
  
  <!-- 客户端层 -->
  <rect x="80" y="70" width="350" height="150" rx="10" class="layer"/>
  <text x="120" y="90" class="subtitle">客户端层 (Client Side)</text>
  
  <!-- Client组件 -->
  <rect x="120" y="110" width="100" height="40" rx="5" class="client-comp"/>
  <text x="170" y="135" text-anchor="middle" class="text">Client</text>
  
  <!-- SaslRpcClient -->
  <rect x="250" y="110" width="100" height="40" rx="5" class="security-comp"/>
  <text x="300" y="135" text-anchor="middle" class="text">SaslRpcClient</text>
  
  <!-- 客户端支持组件 -->
  <rect x="120" y="170" width="80" height="25" rx="3" class="support-comp"/>
  <text x="160" y="187" text-anchor="middle" class="small-text">ConnectionId</text>
  
  <rect x="220" y="170" width="70" height="25" rx="3" class="support-comp"/>
  <text x="255" y="187" text-anchor="middle" class="small-text">Call对象</text>
  
  <rect x="310" y="170" width="80" height="25" rx="3" class="network-comp"/>
  <text x="350" y="187" text-anchor="middle" class="small-text">连接池管理</text>
  
  <!-- 网络传输层 -->
  <rect x="480" y="250" width="200" height="50" rx="10" class="network-comp"/>
  <text x="580" y="280" text-anchor="middle" class="subtitle">网络传输层</text>
  
  <!-- 服务端层 -->
  <rect x="750" y="70" width="350" height="150" rx="10" class="layer"/>
  <text x="790" y="90" class="subtitle">服务端层 (Server Side)</text>
  
  <!-- Server组件 -->
  <rect x="790" y="110" width="100" height="40" rx="5" class="server-comp"/>
  <text x="840" y="135" text-anchor="middle" class="text">Server</text>
  
  <!-- Handler线程池 -->
  <rect x="920" y="110" width="100" height="40" rx="5" class="security-comp"/>
  <text x="970" y="135" text-anchor="middle" class="text">Handler线程池</text>
  
  <!-- 服务端支持组件 -->
  <rect x="790" y="170" width="70" height="25" rx="3" class="support-comp"/>
  <text x="825" y="187" text-anchor="middle" class="small-text">Listener</text>
  
  <rect x="880" y="170" width="110" height="25" rx="3" class="support-comp"/>
  <text x="935" y="187" text-anchor="middle" class="small-text">CallQueueManager</text>
  
  <rect x="1010" y="170" width="110" height="25" rx="3" class="network-comp"/>
  <text x="1065" y="187" text-anchor="middle" class="small-text">ConnectionManager</text>
  
  <!-- RPC引擎层 -->
  <rect x="200" y="350" width="600" height="120" rx="10" class="layer"/>
  <text x="240" y="370" class="subtitle">RPC引擎层 (RpcEngine Layer)</text>
  
  <!-- RpcEngine接口 -->
  <rect x="450" y="380" width="120" height="30" rx="5" class="client-comp"/>
  <text x="510" y="400" text-anchor="middle" class="text">RpcEngine接口</text>
  
  <!-- 具体引擎实现 -->
  <rect x="280" y="430" width="120" height="25" rx="3" class="engine-comp"/>
  <text x="340" y="447" text-anchor="middle" class="small-text">WritableRpcEngine</text>
  
  <rect x="450" y="430" width="100" height="25" rx="3" class="network-comp"/>
  <text x="500" y="447" text-anchor="middle" class="small-text">RPC.RpcKind</text>
  
  <rect x="600" y="430" width="120" height="25" rx="3" class="engine-comp"/>
  <text x="660" y="447" text-anchor="middle" class="small-text">ProtobufRpcEngine2</text>
  
  <!-- 监控层 -->
  <rect x="300" y="500" width="400" height="80" rx="10" class="layer"/>
  <text x="340" y="520" class="subtitle">监控层 (Monitoring Layer)</text>
  
  <!-- 监控组件 -->
  <rect x="350" y="540" width="100" height="25" rx="3" class="monitoring-comp"/>
  <text x="400" y="557" text-anchor="middle" class="small-text">RpcMetrics</text>
  
  <rect x="470" y="540" width="130" height="25" rx="3" class="monitoring-comp"/>
  <text x="535" y="557" text-anchor="middle" class="small-text">RpcDetailedMetrics</text>
  
  <rect x="620" y="540" width="100" height="25" rx="3" class="network-comp"/>
  <text x="670" y="557" text-anchor="middle" class="small-text">性能监控指标</text>
  
  <!-- 连接线 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c"/>
    </marker>
    <marker id="arrowhead-engine" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9b59b6"/>
    </marker>
    <marker id="arrowhead-monitor" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#8e44ad"/>
    </marker>
  </defs>
  
  <!-- 客户端到网络层 -->
  <line x1="430" y1="180" x2="480" y2="260" class="rpc-conn" marker-end="url(#arrowhead)"/>
  <text x="430" y="210" class="small-text" fill="#e74c3c">RPC调用</text>
  
  <!-- 网络层到服务端 -->
  <line x1="680" y1="260" x2="750" y2="180" class="rpc-conn" marker-end="url(#arrowhead)"/>
  
  <!-- RPC引擎连接 -->
  <line x1="480" y1="410" x2="350" y2="430" class="engine-conn" marker-end="url(#arrowhead-engine)"/>
  <line x1="540" y1="410" x2="650" y2="430" class="engine-conn" marker-end="url(#arrowhead-engine)"/>
  <text x="420" y="425" class="small-text" fill="#9b59b6">协议引擎</text>
  
  <!-- 到监控层的连接 -->
  <line x1="500" y1="470" x2="500" y2="500" class="monitor-conn" marker-end="url(#arrowhead-monitor)"/>
  <text x="510" y="485" class="small-text" fill="#8e44ad">性能监控</text>
  
</svg>
